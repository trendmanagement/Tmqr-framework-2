<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <title>Framework introduction (start here) &#8212; TMQR framework 1.0 documentation</title>

    <link rel="stylesheet" href="_static/alabaster.css" type="text/css"/>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css"/>

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT: './',
            VERSION: '1.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE: true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript"
            src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html"/>
    <link rel="search" title="Search" href="search.html"/>

    <link rel="stylesheet" href="_static/custom.css" type="text/css"/>


    <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9"/>

</head>
<body role="document">


<div class="document">
    <div class="documentwrapper">
        <div class="bodywrapper">
            <div class="body" role="main">

                <div class="section" id="framework-introduction-start-here">
                    <span id="framework-introduction"></span>
                    <h1>Framework introduction (start here)<a class="headerlink"
                                                              href="#framework-introduction-start-here"
                                                              title="Permalink to this headline">¶</a></h1>
                    <p><a class="reference internal" href="index.html#index-page"><span class="std std-ref">TMQR Framework 2.0 Home Page</span></a>
                    </p>
                    <div class="toctree-wrapper compound">
                    </div>
                    <div class="section" id="introduction">
                        <h2>Introduction<a class="headerlink" href="#introduction"
                                           title="Permalink to this headline">¶</a></h2>
                        <p>This framework has been designed to be as developer friendly as possible. As a developer you
                            should learn and master few
                            concepts which will help you to build Indexes and Alphas using full strength of tools.</p>
                        <div class="section" id="data-and-position">
                            <h3>Data and position<a class="headerlink" href="#data-and-position"
                                                    title="Permalink to this headline">¶</a></h3>
                            <p>To become fluent in the framework&#8217;s indexes and alphas development you have to
                                master only 2 core classes.</p>
                            <ul class="simple">
                                <li>All aspects of data management are build based on Pandas package, typically all
                                    quotes and price series are <a class="reference external"
                                                                   href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.html">Pandas.DataFrames</a>
                                    All access to data is provided by <a class="reference internal"
                                                                         href="datamanager-class.html#datamanager-class"><span
                                            class="std std-ref">DataManager class</span></a>, probably this is a core of
                                    entire framework.
                                </li>
                                <li>All indexes and alphas are using <a class="reference internal"
                                                                        href="position-class.html#position-class"><span
                                        class="std std-ref">Position class</span></a> to build, manage and make
                                    calculations.
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="section" id="datamanager">
                        <h2>DataManager<a class="headerlink" href="#datamanager"
                                          title="Permalink to this headline">¶</a></h2>
                        <p>The class which is manages everything. You can always refer to autogenerated information
                            about <a class="reference internal" href="datamanager-class.html#datamanager-class"><span
                                    class="std std-ref">DataManager class</span></a>.</p>
                        <p>In this section you will find description of common DataManager applications.</p>
                        <dl class="docutils">
                            <dt>There are 2 phases of DataManager usage:</dt>
                            <dd>
                                <ol class="first last arabic simple">
                                    <li>Initialization phase - usually in <code class="docutils literal"><span
                                            class="pre">setup()</span></code> method of index or alpha class, in this
                                        phase you have to set up
                                        asset trading session, set up costs, and finally set the quotes up.
                                    </li>
                                    <li>Runtime phase - after setup you can fetch quotes series from datamanager for
                                        quantitative analysis, and get pre-loaded
                                        positions of Quote* algorithms or indexes, also you can fetch future and options
                                        contracts from chains and use them
                                        in position construction process.
                                    </li>
                                </ol>
                            </dd>
                        </dl>
                        <div class="section" id="setting-quotes-series">
                            <h3>Setting quotes series<a class="headerlink" href="#setting-quotes-series"
                                                        title="Permalink to this headline">¶</a></h3>
                            <p>The main purpose of the DataManager class is to get the quotes data for particular
                                instrument or index from the DB.
                                There are 2 main ways to set the data <code class="docutils literal"><span class="pre">datamanager.series_primary_set(...)</span></code>
                                and <code class="docutils literal"><span class="pre">series_extra_set(...)</span></code>.
                                Primary series
                                are used for initiation of data series, you <strong>must call</strong> <code
                                        class="docutils literal"><span class="pre">series_primary_set(...)</span></code>
                                every time, because datetime series of
                                primary quotes is used as anchor for extra series (a.k.a. secondary series) or position
                                calculation.</p>
                            <p>To set up primary quotes you have to use one of the <a class="reference internal"
                                                                                      href="quote-modules.html#quote-modules"><span
                                    class="std std-ref">Quote* modules</span></a> by the following way:</p>
                            <div class="highlight-default">
                                <div class="highlight"><pre><span></span><span class="c1"># To set continuous futures index for &#39;US.ES&#39; instrument with decision_time_shift (for index usage)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="o">.</span><span class="n">series_primary_set</span><span
                                            class="p">(</span><span class="n">QuoteContFut</span><span
                                            class="p">,</span> <span class="s1">&#39;US.ES&#39;</span><span
                                            class="p">,</span> <span class="n">timeframe</span><span
                                            class="o">=</span><span class="s1">&#39;D&#39;</span><span
                                            class="p">)</span>
                           <span class="c1"># decision_time_shift=self.decision_time_shift) # This setting is optional for alphas and required for indexes!</span>


<span class="c1"># To set pre-saved index series as primary quotes and series</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="o">.</span><span class="n">series_primary_set</span><span
                                            class="p">(</span><span class="n">QuoteIndex</span><span class="p">,</span> <span
                                            class="s2">&quot;US.ES_ContFut&quot;</span><span class="p">,</span> <span
                                            class="n">set_session</span><span class="o">=</span><span
                                            class="kc">True</span><span class="p">,</span> <span
                                            class="n">check_session</span><span class="o">=</span><span
                                            class="kc">True</span><span class="p">)</span>
</pre>
                                </div>
                            </div>
                            <p>To set up secondary quotes you have to call series_extra_set(...) with one of the <a
                                    class="reference internal" href="quote-modules.html#quote-modules"><span
                                    class="std std-ref">Quote* modules</span></a>, also you need
                                to define key-name for secondary quotes series that will be used for quotes access
                                later:</p>
                            <div class="highlight-default">
                                <div class="highlight"><pre><span></span><span class="c1"># To set continuous futures index for &#39;US.CL&#39; instrument with decision_time_shift (for index usage)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="o">.</span><span class="n">series_extra_set</span><span
                                            class="p">(</span><span
                                            class="s1">&#39;secondary_future_key_name&#39;</span><span
                                            class="p">,</span> <span class="n">QuoteContFut</span><span
                                            class="p">,</span> <span class="s1">&#39;US.CL&#39;</span><span
                                            class="p">,</span> <span class="n">timeframe</span><span
                                            class="o">=</span><span class="s1">&#39;D&#39;</span><span
                                            class="p">)</span>
                         <span class="c1"># decision_time_shift=self.decision_time_shift) # This setting is optional for alphas and required for indexes!</span>

<span class="c1"># To set pre-saved index series as secondary quotes and series</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="o">.</span><span class="n">series_extra_set</span><span
                                            class="p">(</span><span class="s1">&#39;secondary_index_key_name&#39;</span><span
                                            class="p">,</span> <span class="n">QuoteIndex</span><span class="p">,</span> <span
                                            class="s2">&quot;US.ES_Fancy_SmartEXO_Index&quot;</span><span
                                            class="p">,</span> <span class="n">set_session</span><span
                                            class="o">=</span><span class="kc">True</span><span class="p">,</span> <span
                                            class="n">check_session</span><span class="o">=</span><span
                                            class="kc">True</span><span class="p">)</span>
</pre>
                                </div>
                            </div>
                            <div class="admonition note">
                                <p class="first admonition-title">Note</p>
                                <ul class="last simple">
                                    <li>You must always define <code class="docutils literal"><span class="pre">datamanager.series_primary_set(...)</span></code>
                                    </li>
                                    <li>You must always call <code class="docutils literal"><span class="pre">datamanager.session_set()</span></code>
                                        before quotes initiation
                                    </li>
                                    <li>Extra (a.k.a. secondary) series already aligned to the primary series by date
                                    </li>
                                    <li>You must define <code class="docutils literal"><span class="pre">decision_time_shift</span></code>
                                        argument when you are working on index, and mustn&#8217;t in case of alpha
                                        development
                                    </li>
                                    <li>Typically you can access DataManager class for index or alpha by calling
                                        self.dm.&lt;some_method(..)&gt;
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="section" id="getting-quotes-series">
                            <h3>Getting quotes series<a class="headerlink" href="#getting-quotes-series"
                                                        title="Permalink to this headline">¶</a></h3>
                            <p>When primary and secondary (a.k.a. extra) quotes have been set somewhere in the <code
                                    class="docutils literal"><span class="pre">setup()</span></code> method of index or
                                alphas, you
                                would be able to access these quotes to perform calculations, both series can be fetched
                                by calling <code class="docutils literal"><span class="pre">datamanager.quotes(series_key=None)</span></code>
                                method,
                                where <strong>series_key=</strong> is a extra series key defined at <code
                                        class="docutils literal"><span class="pre">series_extra_set(...)</span></code>.
                            </p>
                            <p>Examples based on quotes settings above:</p>
                            <div class="highlight-default">
                                <div class="highlight"><pre><span></span><span class="c1"># Typically you can access DataManager class for index or alpha by calling self.dm.&lt;some_method(..)&gt;</span>
<span class="n">es_future_primary</span> <span class="o">=</span> <span class="bp">self</span><span
                                            class="o">.</span><span class="n">dm</span><span class="o">.</span><span
                                            class="n">quotes</span><span class="p">()</span>
<span class="n">es_future_primary_alternative</span> <span class="o">=</span> <span class="bp">self</span><span
                                            class="o">.</span><span class="n">dm</span><span class="o">.</span><span
                                            class="n">quotes</span><span class="p">(</span><span
                                            class="n">series_key</span><span class="o">=</span><span
                                            class="kc">None</span><span class="p">)</span>

<span class="c1"># Getting secondary data</span>
<span class="n">secondary_future_cl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span
                                            class="n">dm</span><span class="o">.</span><span class="n">quote</span><span
                                            class="p">(</span><span class="n">series_key</span><span
                                            class="o">=</span><span
                                            class="s1">&#39;secondary_future_key_name&#39;</span><span
                                            class="p">)</span>
<span class="n">secondary_pre_saved_index</span> <span class="o">=</span> <span class="bp">self</span><span
                                            class="o">.</span><span class="n">dm</span><span class="o">.</span><span
                                            class="n">quote</span><span class="p">(</span><span class="s1">&#39;secondary_index_key_name&#39;</span><span
                                            class="p">)</span> <span class="c1"># You can omit series_key=</span>

<span class="c1"># These series above are Pandas.DataFrames</span>
<span class="c1"># You have to access by column name to get OHLCV for QuoteContFut based results</span>
<span class="n">open_price</span> <span class="o">=</span> <span class="n">es_future_primary</span><span
                                            class="p">[</span><span class="s1">&#39;o&#39;</span><span
                                            class="p">]</span>
<span class="n">high_price</span> <span class="o">=</span> <span class="n">es_future_primary</span><span
                                            class="p">[</span><span class="s1">&#39;h&#39;</span><span
                                            class="p">]</span>
<span class="n">low_price</span> <span class="o">=</span> <span class="n">es_future_primary</span><span
                                            class="p">[</span><span class="s1">&#39;l&#39;</span><span
                                            class="p">]</span>
<span class="n">close_price</span> <span class="o">=</span> <span class="n">es_future_primary</span><span
                                            class="p">[</span><span class="s1">&#39;c&#39;</span><span
                                            class="p">]</span>

<span class="c1"># For quotes produces by Index it&#39;s more complicated</span>
<span class="c1"># There is no naming conventions for index columns</span>

<span class="c1"># For positional indexes like EXOs/SmartEXOs column names should be</span>
<span class="c1"># &#39;costs&#39;,</span>
<span class="c1"># &#39;ncontracts_executed&#39;,</span>
<span class="c1"># &#39;noptions_executed&#39;,</span>
<span class="c1"># &#39;pnl_change_decision&#39;,</span>
<span class="c1"># &#39;pnl_change_execution&#39;,</span>
<span class="c1"># &#39;equity_decision&#39;,</span>
<span class="c1"># &#39;equity_execution&#39;</span>

<span class="c1"># It&#39;s recommended to use &#39;equity_decision&#39; for decision making in alphas</span>
<span class="n">index_price</span> <span class="o">=</span> <span class="n">secondary_pre_saved_index</span><span
                                            class="p">[</span><span class="s1">&#39;equity_execution&#39;</span><span
                                            class="p">]</span>
</pre>
                                </div>
                            </div>
                        </div>
                        <div class="section" id="getting-positions">
                            <h3>Getting positions<a class="headerlink" href="#getting-positions"
                                                    title="Permalink to this headline">¶</a></h3>
                            <p>When you call <code class="docutils literal"><span class="pre">datamanager.series_primary_set(...)</span></code>
                                or <code class="docutils literal"><span class="pre">series_extra_set(...)</span></code>
                                Quote* algorithms also calculate the
                                underlying position of Quotes* series, for example QuoteContFut position represents
                                holdings of actual front month future
                                contract and valid roll over trades to maintain the position. QuoteIndex algorithm&#8217;s
                                position will contain full EXO/SmartEXO
                                structure as well.</p>
                            <p>Foe example, this flexible position getting allow you to implement alphas which
                                rebalancing between different types of EXO indexes.</p>
                            <p>The position getting API is very similar to quotes, just call <code
                                    class="docutils literal"><span
                                    class="pre">datamanager.position(position_key=None)</span></code>:</p>
                            <p>Example based on positions settings above:</p>
                            <div class="highlight-default">
                                <div class="highlight"><pre><span></span><span class="c1"># Typically you can access DataManager class for index or alpha by calling self.dm.&lt;some_method(..)&gt;</span>
<span class="n">es_future_primary_position</span> <span class="o">=</span> <span class="bp">self</span><span
                                            class="o">.</span><span class="n">dm</span><span class="o">.</span><span
                                            class="n">position</span><span class="p">()</span>
<span class="n">es_future_primary_position</span> <span class="o">=</span> <span class="bp">self</span><span
                                            class="o">.</span><span class="n">dm</span><span class="o">.</span><span
                                            class="n">position</span><span class="p">(</span><span class="n">position_key</span><span
                                            class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># Getting secondary data</span>
<span class="n">secondary_future_cl_position</span> <span class="o">=</span> <span class="bp">self</span><span
                                            class="o">.</span><span class="n">dm</span><span class="o">.</span><span
                                            class="n">position</span><span class="p">(</span><span class="n">position_key</span><span
                                            class="o">=</span><span
                                            class="s1">&#39;secondary_future_key_name&#39;</span><span
                                            class="p">)</span>
<span class="n">secondary_pre_saved_index_position</span> <span class="o">=</span> <span class="bp">self</span><span
                                            class="o">.</span><span class="n">dm</span><span class="o">.</span><span
                                            class="n">position</span><span class="p">(</span><span class="s1">&#39;secondary_index_key_name&#39;</span><span
                                            class="p">)</span> <span class="c1"># You can omit position_key=</span>
</pre>
                                </div>
                            </div>
                        </div>
                        <div class="section" id="setting-session-parameters">
                            <h3>Setting session parameters<a class="headerlink" href="#setting-session-parameters"
                                                             title="Permalink to this headline">¶</a></h3>
                            <p>Asset sessions are used for building quotes and position arrangement. Typically every
                                instrument in TMQR framework 1.0 has
                                own session settings. Usually you need to use instrument name to set the session up, but
                                in case when you need to build
                                multi-instrument index you have to set custom session setting to align all instruments&#8217;
                                quotes to common timeline.</p>
                            <p>Setting session is required every time when you are going to use DataManager Quote*
                                engine, you should set session before
                                setting the quotes by calling <code class="docutils literal"><span class="pre">datamanager.series_primary_set(...)</span></code>
                                and <code class="docutils literal"><span class="pre">series_extra_set(...)</span></code>.
                            </p>
                            <p>To get more information refer to <a class="reference internal"
                                                                   href="datamanager-class.html#tmqrfeed.manager.DataManager.session_set"
                                                                   title="tmqrfeed.manager.DataManager.session_set"><code
                                    class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.manager.DataManager.session_set()</span></code></a>
                                help.</p>
                            <p>Examples:</p>
                            <div class="highlight-default">
                                <div class="highlight"><pre><span></span><span class="c1"># Setting instrument specific session</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="o">.</span><span class="n">session_set</span><span
                                            class="p">(</span><span class="s2">&quot;US.ES&quot;</span><span
                                            class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="o">.</span><span class="n">session_set</span><span
                                            class="p">(</span><span class="n">instrument</span><span
                                            class="o">=</span><span class="s2">&quot;US.ES&quot;</span><span
                                            class="p">)</span>

<span class="c1"># Setting custom session (for spread index)</span>
<span class="n">session_settings</span> <span class="o">=</span> <span class="p">[</span>
                <span class="c1"># Default session</span>
                <span class="p">{</span>
                <span class="s1">&#39;decision&#39;</span><span class="p">:</span> <span
                                            class="s1">&#39;10:40&#39;</span><span class="p">,</span>             <span
                                            class="c1"># Decision time (uses &#39;tz&#39; param time zone!)</span>
                <span class="s1">&#39;dt&#39;</span><span class="p">:</span> <span class="n">datetime</span><span
                                            class="p">(</span><span class="mi">1900</span><span class="p">,</span> <span
                                            class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span
                                            class="p">),</span>    <span class="c1"># Actual date of default session start</span>
                <span class="s1">&#39;execution&#39;</span><span class="p">:</span> <span
                                            class="s1">&#39;10:45&#39;</span><span class="p">,</span>            <span
                                            class="c1"># Execution time (uses &#39;tz&#39; param time zone!)</span>
                <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;03:32&#39;</span>                 <span
                                            class="c1"># Start of the session time (uses &#39;tz&#39; param time zone!)</span>
                <span class="p">},</span>

                <span class="c1"># If session rules has been changed by exchange, you can set different rules</span>
                <span class="p">{</span>
                <span class="s1">&#39;decision&#39;</span><span class="p">:</span> <span
                                            class="s1">&#39;11:40&#39;</span><span class="p">,</span>             <span
                                            class="c1"># Decision time (uses &#39;tz&#39; param time zone!)</span>
                <span class="s1">&#39;dt&#39;</span><span class="p">:</span> <span class="n">datetime</span><span
                                            class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span
                                            class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span
                                            class="p">),</span>    <span class="c1"># Actual date of new session rules start</span>
                <span class="s1">&#39;execution&#39;</span><span class="p">:</span> <span
                                            class="s1">&#39;11:45&#39;</span><span class="p">,</span>            <span
                                            class="c1"># Execution time (uses &#39;tz&#39; param time zone!)</span>
                <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;01:32&#39;</span>                 <span
                                            class="c1"># Start of the session time (uses &#39;tz&#39; param time zone!)</span>
                <span class="p">},</span>
            <span class="p">]</span>

<span class="c1"># Timezone names list https://en.wikipedia.org/wiki/List_of_tz_database_time_zones</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="o">.</span><span class="n">session_set</span><span
                                            class="p">(</span><span class="n">session_list</span><span
                                            class="o">=</span><span class="n">session_settings</span><span
                                            class="p">,</span> <span class="n">tz</span><span class="o">=</span><span
                                            class="s1">&#39;US/Pacific&#39;</span><span class="p">)</span>
</pre>
                                </div>
                            </div>
                        </div>
                        <div class="section" id="setting-costs">
                            <h3>Setting costs<a class="headerlink" href="#setting-costs"
                                                title="Permalink to this headline">¶</a></h3>
                            <p>Costs are required to calculate Index or Alpha positions, typically costs are set in
                                <code class="docutils literal"><span class="pre">setup()</span></code> method. Sometimes
                                you need
                                just to set costs values as parameters of the index or alpha, sometimes you will have to
                                set the costs manually.</p>
                            <p>Example:</p>
                            <div class="highlight-default">
                                <div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tmqrfeed</span> <span
                                        class="k">import</span> <span class="n">Costs</span>

<span class="c1">#... somewhere in setup() method of Index or Alpha call</span>


<span class="c1"># Setting costs per future contract and option</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="o">.</span><span class="n">costs_set</span><span
                                            class="p">(</span><span class="s1">&#39;US&#39;</span><span
                                            class="p">,</span> <span class="n">Costs</span><span class="p">(</span><span
                                            class="n">per_contract</span><span class="o">=</span><span
                                            class="mf">3.0</span><span class="p">,</span> <span
                                            class="n">per_option</span><span class="o">=</span><span
                                            class="mf">3.0</span><span class="p">))</span>

<span class="c1"># Setting default costs (i.e. zero costs)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="o">.</span><span class="n">costs_set</span><span
                                            class="p">(</span><span class="s1">&#39;US&#39;</span><span
                                            class="p">,</span> <span class="n">Costs</span><span class="p">())</span>
</pre>
                                </div>
                            </div>
                            <div class="admonition note">
                                <p class="first admonition-title">Note</p>
                                <ul class="last simple">
                                    <li>Costs are set on per-market basis</li>
                                    <li>Setting costs it required any time when you are developing index or alpha</li>
                                </ul>
                            </div>
                        </div>
                        <div class="section" id="chains-getting">
                            <h3>Chains getting<a class="headerlink" href="#chains-getting"
                                                 title="Permalink to this headline">¶</a></h3>
                            <dl class="docutils">
                                <dt>You can fetch 2 types of chains from DataManager:</dt>
                                <dd>
                                    <ol class="first last arabic">
                                        <li><p class="first">Futures chains getting mechanism allows you to select any
                                            future contract you want, you are free to fetch any
                                            instrument available in the DB. Refer to <a class="reference internal"
                                                                                        href="datamanager-class.html#tmqrfeed.manager.DataManager.chains_futures_get"
                                                                                        title="tmqrfeed.manager.DataManager.chains_futures_get"><code
                                                    class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.manager.DataManager.chains_futures_get()</span></code></a>
                                            to get more information.</p>
                                            <blockquote>
                                                <div><p>Example:</p>
                                                    <div class="highlight-default">
                                                        <div class="highlight"><pre><span></span><span class="c1"># Getting front month ES future</span>
<span class="n">es_front_future</span> <span class="o">=</span> <span class="bp">self</span><span
                                                                    class="o">.</span><span class="n">dm</span><span
                                                                    class="o">.</span><span
                                                                    class="n">chains_futures_get</span><span
                                                                    class="p">(</span><span
                                                                    class="s1">&#39;US.ES&#39;</span><span
                                                                    class="p">,</span> <span class="n">dt</span><span
                                                                    class="p">,</span> <span
                                                                    class="n">offset</span><span class="o">=</span><span
                                                                    class="mi">0</span><span class="p">)</span>

<span class="c1"># Getting next month CL future</span>
<span class="n">cl_next_future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span
                                                                    class="n">dm</span><span class="o">.</span><span
                                                                    class="n">chains_futures_get</span><span
                                                                    class="p">(</span><span
                                                                    class="s1">&#39;US.CL&#39;</span><span
                                                                    class="p">,</span> <span class="n">dt</span><span
                                                                    class="p">,</span> <span
                                                                    class="n">offset</span><span class="o">=</span><span
                                                                    class="mi">1</span><span class="p">)</span>
</pre>
                                                        </div>
                                                    </div>
                                                </div>
                                            </blockquote>
                                        </li>
                                        <li><p class="first">You can get future + option chain pair if you need to
                                            initiate complex future + options position. Refer to
                                            <a class="reference internal"
                                               href="datamanager-class.html#tmqrfeed.manager.DataManager.chains_options_get"
                                               title="tmqrfeed.manager.DataManager.chains_options_get"><code
                                                    class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.manager.DataManager.chains_options_get()</span></code></a>
                                            to get more information (<strong>pay more attention</strong> to kwarg
                                            parameters).</p>
                                            <blockquote>
                                                <div><p>Example:</p>
                                                    <div class="highlight-default">
                                                        <div class="highlight"><pre><span></span><span class="c1"># Getting front option and underlying future</span>
<span class="n">fut</span><span class="p">,</span> <span class="n">opt_chain</span> <span class="o">=</span> <span
                                                                    class="bp">self</span><span class="o">.</span><span
                                                                    class="n">dm</span><span class="o">.</span><span
                                                                    class="n">chains_options_get</span><span
                                                                    class="p">(</span><span
                                                                    class="s1">&#39;US.ES&#39;</span><span
                                                                    class="p">,</span> <span class="n">dt</span><span
                                                                    class="p">)</span>

<span class="c1"># Getting front + 2 option contract and underlying future</span>
<span class="n">fut_next</span><span class="p">,</span> <span class="n">opt_chain_next</span> <span
                                                                    class="o">=</span> <span class="bp">self</span><span
                                                                    class="o">.</span><span class="n">dm</span><span
                                                                    class="o">.</span><span
                                                                    class="n">chains_options_get</span><span
                                                                    class="p">(</span><span
                                                                    class="s1">&#39;US.ES&#39;</span><span
                                                                    class="p">,</span> <span class="n">dt</span><span
                                                                    class="p">,</span> <span class="n">opt_offset</span><span
                                                                    class="o">=</span><span class="mi">2</span><span
                                                                    class="p">)</span>
</pre>
                                                        </div>
                                                    </div>
                                                    <div class="admonition note">
                                                        <p class="first admonition-title">Note</p>
                                                        <ul class="last simple">
                                                            <li>Refer to documentation of &#8216;fut&#8217; part of
                                                                return value <a class="reference internal"
                                                                                href="contracts-module.html#tmqrfeed.contracts.FutureContract"
                                                                                title="tmqrfeed.contracts.FutureContract"><code
                                                                        class="xref py py-class docutils literal"><span
                                                                        class="pre">tmqrfeed.contracts.FutureContract</span></code></a>
                                                            </li>
                                                            <li>Refer to documentation of &#8216;opt_chain&#8217; part
                                                                of return value <a class="reference internal"
                                                                                   href="chains-module.html#tmqrfeed.chains.OptionChain"
                                                                                   title="tmqrfeed.chains.OptionChain"><code
                                                                        class="xref py py-class docutils literal"><span
                                                                        class="pre">tmqrfeed.chains.OptionChain</span></code></a>
                                                                (<strong>pay more attention</strong> to
                                                                <strong>find</strong> method!)
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </blockquote>
                                        </li>
                                    </ol>
                                </dd>
                            </dl>
                        </div>
                    </div>
                    <div class="section" id="position">
                        <h2>Position<a class="headerlink" href="#position" title="Permalink to this headline">¶</a></h2>
                        <p>Position concept is a foundation of the framework, EXO index series are build on position&#8217;s
                            PnL, alphas equity lines are
                            also produced by position calculations. General reference of <a class="reference internal"
                                                                                            href="position-class.html#position-class"><span
                                    class="std std-ref">Position class</span></a></p>
                        <dl class="docutils">
                            <dt>You can build position in 3 different ways:</dt>
                            <dd>
                                <ol class="first last arabic simple">
                                    <li>You can replicate position of <a class="reference internal"
                                                                         href="quote-modules.html#quote-modules"><span
                                            class="std std-ref">Quote* modules</span></a> or index inside developed
                                        index or alpha
                                    </li>
                                    <li>You can build your own position by adding transactions to the position</li>
                                    <li>You can mix both approaches, at the first step you can replicate index position,
                                        then check it&#8217;s delta and hedge
                                        it by adding future transaction.
                                    </li>
                                </ol>
                            </dd>
                        </dl>
                        <div class="section" id="position-replication">
                            <h3>Position replication<a class="headerlink" href="#position-replication"
                                                       title="Permalink to this headline">¶</a></h3>
                            <p>For example you would like to replicate index position, in your alpha:</p>
                            <div class="highlight-default">
                                <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">setup</span><span
                                        class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1">#...</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">dm</span><span class="o">.</span><span
                                            class="n">series_extra_set</span><span class="p">(</span><span class="s1">&#39;secondary_index_key_name&#39;</span><span
                                            class="p">,</span> <span class="n">QuoteIndex</span><span class="p">,</span> <span
                                            class="s2">&quot;US.ES_Fancy_SmartEXO_Index&quot;</span><span
                                            class="p">,</span> <span class="n">set_session</span><span
                                            class="o">=</span><span class="kc">True</span><span class="p">,</span> <span
                                            class="n">check_session</span><span class="o">=</span><span
                                            class="kc">True</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">calculate_position</span><span class="p">(</span><span
                                            class="bp">self</span><span class="p">,</span> <span
                                            class="n">date</span><span class="p">:</span> <span
                                            class="n">datetime</span><span class="p">,</span> <span class="n">exposure_record</span><span
                                            class="p">:</span> <span class="n">pd</span><span class="o">.</span><span
                                            class="n">DataFrame</span><span class="p">):</span>
    <span class="c1"># This is main position management method for alphas</span>

    <span class="c1"># Getting the index&#39;s position</span>
    <span class="n">index_position</span> <span class="o">=</span> <span class="bp">self</span><span
                                            class="o">.</span><span class="n">dm</span><span class="o">.</span><span
                                            class="n">position</span><span class="p">(</span><span class="s1">&#39;secondary_index_key_name&#39;</span><span
                                            class="p">)</span>

    <span class="c1"># Getting position records at particular date</span>
    <span class="n">replicated_pos</span> <span class="o">=</span> <span class="n">index_position</span><span class="o">.</span><span
                                            class="n">get_net_position</span><span class="p">(</span><span class="n">date</span><span
                                            class="p">)</span>

    <span class="c1"># Setting position of alpha to replicated position</span>
    <span class="c1"># qty= means N-units times index position</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span
                                            class="n">add_net_position</span><span class="p">(</span><span class="n">date</span><span
                                            class="p">,</span> <span class="n">replicated_pos</span><span
                                            class="p">,</span> <span class="n">qty</span><span class="o">=</span><span
                                            class="mf">2.0</span><span class="p">)</span>
</pre>
                                </div>
                            </div>
                            <div class="admonition note">
                                <p class="first admonition-title">Note</p>
                                <p>Position replication methods:</p>
                                <ul class="last simple">
                                    <li><a class="reference internal"
                                           href="position-class.html#tmqrfeed.position.Position.add_net_position"
                                           title="tmqrfeed.position.Position.add_net_position"><code
                                            class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.position.Position.add_net_position()</span></code></a>
                                    </li>
                                    <li><a class="reference internal"
                                           href="position-class.html#tmqrfeed.position.Position.get_net_position"
                                           title="tmqrfeed.position.Position.get_net_position"><code
                                            class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.position.Position.get_net_position()</span></code></a>
                                    </li>
                                    <li><a class="reference internal"
                                           href="position-class.html#tmqrfeed.position.Position.set_net_position"
                                           title="tmqrfeed.position.Position.set_net_position"><code
                                            class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.position.Position.set_net_position()</span></code></a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="section" id="position-construction">
                            <h3>Position construction<a class="headerlink" href="#position-construction"
                                                        title="Permalink to this headline">¶</a></h3>
                            <p>In case of EXO index building you have probably wanted to build custom position to
                                implement some sort of option model.</p>
                            <p>To do this you have to be familiar with datamanger chains fetching by <a
                                    class="reference internal"
                                    href="datamanager-class.html#tmqrfeed.manager.DataManager.chains_options_get"
                                    title="tmqrfeed.manager.DataManager.chains_options_get"><code
                                    class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.manager.DataManager.chains_options_get()</span></code></a>
                                and <a class="reference internal"
                                       href="chains-module.html#tmqrfeed.chains.OptionChain.find"
                                       title="tmqrfeed.chains.OptionChain.find"><code
                                        class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.chains.OptionChain.find()</span></code></a>
                                method usage.</p>
                            <p>Example:</p>
                            <div class="highlight-default">
                                <div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">construct_position</span><span
                                        class="p">(</span><span class="bp">self</span><span class="p">,</span> <span
                                        class="n">dt</span><span class="p">,</span> <span class="n">pos</span><span
                                        class="p">,</span> <span class="n">logic_df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    EXO position construction method</span>
<span class="sd">    :param dt: current datetime</span>
<span class="sd">    :param pos: Position instance</span>
<span class="sd">    :param logic_df: result of calc_exo_logic()[dt]  if applicable</span>
<span class="sd">    :return: nothing, manages &#39;pos&#39; in place</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Getting future contract and option chain</span>
    <span class="n">fut</span><span class="p">,</span> <span class="n">opt_chain</span> <span class="o">=</span> <span
                                            class="bp">self</span><span class="o">.</span><span class="n">dm</span><span
                                            class="o">.</span><span class="n">chains_options_get</span><span
                                            class="p">(</span><span class="bp">self</span><span class="o">.</span><span
                                            class="n">instrument</span><span class="p">,</span> <span
                                            class="n">dt</span><span class="p">)</span>

    <span class="c1"># Selling 5.0 ATM Put options</span>
    <span class="n">pos</span><span class="o">.</span><span class="n">add_transaction</span><span
                                            class="p">(</span><span class="n">dt</span><span class="p">,</span> <span
                                            class="n">opt_chain</span><span class="o">.</span><span
                                            class="n">find</span><span class="p">(</span><span class="n">dt</span><span
                                            class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span
                                            class="s1">&#39;P&#39;</span><span class="p">),</span> <span
                                            class="o">-</span><span class="mf">5.0</span><span class="p">)</span>
</pre>
                                </div>
                            </div>
                            <div class="admonition note">
                                <p class="first admonition-title">Note</p>
                                <p>Position management and other related methods:</p>
                                <ul class="last simple">
                                    <li><a class="reference internal"
                                           href="datamanager-class.html#tmqrfeed.manager.DataManager.chains_options_get"
                                           title="tmqrfeed.manager.DataManager.chains_options_get"><code
                                            class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.manager.DataManager.chains_options_get()</span></code></a>
                                    </li>
                                    <li><a class="reference internal"
                                           href="chains-module.html#tmqrfeed.chains.OptionChain.find"
                                           title="tmqrfeed.chains.OptionChain.find"><code
                                            class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.chains.OptionChain.find()</span></code></a>
                                    </li>
                                    <li><a class="reference internal"
                                           href="position-class.html#tmqrfeed.position.Position.add_transaction"
                                           title="tmqrfeed.position.Position.add_transaction"><code
                                            class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.position.Position.add_transaction()</span></code></a>
                                    </li>
                                    <li><a class="reference internal"
                                           href="position-class.html#tmqrfeed.position.Position.close"
                                           title="tmqrfeed.position.Position.close"><code
                                            class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.position.Position.close()</span></code></a>
                                    </li>
                                    <li><a class="reference internal"
                                           href="position-class.html#tmqrfeed.position.Position.keep_previous_position"
                                           title="tmqrfeed.position.Position.keep_previous_position"><code
                                            class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.position.Position.keep_previous_position()</span></code></a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="section" id="position-information">
                            <h3>Position information<a class="headerlink" href="#position-information"
                                                       title="Permalink to this headline">¶</a></h3>
                            <ul class="simple">
                                <li><a class="reference internal"
                                       href="position-class.html#tmqrfeed.position.Position.has_position"
                                       title="tmqrfeed.position.Position.has_position"><code
                                        class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.position.Position.has_position()</span></code></a>
                                    - position existence check at particular date
                                </li>
                                <li><a class="reference internal"
                                       href="position-class.html#tmqrfeed.position.Position.delta"
                                       title="tmqrfeed.position.Position.delta"><code
                                        class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.position.Position.delta()</span></code></a>
                                    - calculates position delta
                                </li>
                                <li><a class="reference internal"
                                       href="position-class.html#tmqrfeed.position.Position.almost_expired_ratio"
                                       title="tmqrfeed.position.Position.almost_expired_ratio"><code
                                        class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.position.Position.almost_expired_ratio()</span></code></a>
                                    - return the fraction of contracts in the position &#8216;rollover_days_before&#8217;
                                    near expiration
                                </li>
                                <li><code class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.position.Position.last_date()</span></code>
                                    - last date of the position
                                </li>
                                <li><a class="reference internal"
                                       href="position-class.html#tmqrfeed.position.Position.last_transaction_date"
                                       title="tmqrfeed.position.Position.last_transaction_date"><code
                                        class="xref py py-meth docutils literal"><span class="pre">tmqrfeed.position.Position.last_transaction_date()</span></code></a>
                                    - last transaction date of the position
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
    <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
                <li><a class="reference internal" href="#">Framework introduction (start here)</a>
                    <ul>
                        <li><a class="reference internal" href="#introduction">Introduction</a>
                            <ul>
                                <li><a class="reference internal" href="#data-and-position">Data and position</a></li>
                            </ul>
                        </li>
                        <li><a class="reference internal" href="#datamanager">DataManager</a>
                            <ul>
                                <li><a class="reference internal" href="#setting-quotes-series">Setting quotes
                                    series</a></li>
                                <li><a class="reference internal" href="#getting-quotes-series">Getting quotes
                                    series</a></li>
                                <li><a class="reference internal" href="#getting-positions">Getting positions</a></li>
                                <li><a class="reference internal" href="#setting-session-parameters">Setting session
                                    parameters</a></li>
                                <li><a class="reference internal" href="#setting-costs">Setting costs</a></li>
                                <li><a class="reference internal" href="#chains-getting">Chains getting</a></li>
                            </ul>
                        </li>
                        <li><a class="reference internal" href="#position">Position</a>
                            <ul>
                                <li><a class="reference internal" href="#position-replication">Position replication</a>
                                </li>
                                <li><a class="reference internal" href="#position-construction">Position
                                    construction</a></li>
                                <li><a class="reference internal" href="#position-information">Position information</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
            <div class="relations">
                <h3>Related Topics</h3>
                <ul>
                    <li><a href="index.html">Documentation overview</a>
                        <ul>
                        </ul>
                    </li>
                </ul>
            </div>
            <div role="note" aria-label="source link">
                <h3>This Page</h3>
                <ul class="this-page-menu">
                    <li><a href="_sources/framework-introduction.rst.txt"
                           rel="nofollow">Show Source</a></li>
                </ul>
            </div>
            <div id="searchbox" style="display: none" role="search">
                <h3>Quick search</h3>
                <form class="search" action="search.html" method="get">
                    <div><input type="text" name="q"/></div>
                    <div><input type="submit" value="Go"/></div>
                    <input type="hidden" name="check_keywords" value="yes"/>
                    <input type="hidden" name="area" value="default"/>
                </form>
            </div>
            <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
    </div>
    <div class="clearer"></div>
</div>
<div class="footer">
    &copy;2016, TMQR.

    |
    Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.1</a>
    &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.9</a>

    |
    <a href="_sources/framework-introduction.rst.txt"
       rel="nofollow">Page source</a>
</div>


</body>
</html>